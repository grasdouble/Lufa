<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lightspeed Jump - Algorithmic Art</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Lora:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --anthropic-dark: #141413;
        --anthropic-light: #faf9f5;
        --anthropic-mid-gray: #b0aea5;
        --anthropic-light-gray: #e8e6dc;
        --anthropic-orange: #d97757;
        --anthropic-blue: #6a9bcc;
        --anthropic-green: #788c5d;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Poppins', sans-serif;
        background: linear-gradient(135deg, #000000 0%, #0a0a14 100%);
        min-height: 100vh;
        color: var(--anthropic-light);
      }

      .container {
        display: flex;
        min-height: 100vh;
        padding: 20px;
        gap: 20px;
      }

      .sidebar {
        width: 320px;
        flex-shrink: 0;
        background: rgba(20, 20, 19, 0.98);
        backdrop-filter: blur(10px);
        padding: 24px;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        overflow-y: auto;
        border: 1px solid rgba(106, 155, 204, 0.2);
      }

      .sidebar h1 {
        font-family: 'Lora', serif;
        font-size: 24px;
        font-weight: 500;
        color: var(--anthropic-light);
        margin-bottom: 8px;
      }

      .sidebar .subtitle {
        color: var(--anthropic-mid-gray);
        font-size: 14px;
        margin-bottom: 32px;
        line-height: 1.4;
      }

      .control-section {
        margin-bottom: 32px;
      }

      .control-section h3 {
        font-size: 16px;
        font-weight: 600;
        color: var(--anthropic-light);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-section h3::before {
        content: 'â€¢';
        color: var(--anthropic-blue);
        font-weight: bold;
      }

      .seed-input {
        width: 100%;
        background: rgba(250, 249, 245, 0.1);
        padding: 12px;
        border-radius: 8px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        margin-bottom: 12px;
        border: 1px solid rgba(106, 155, 204, 0.3);
        text-align: center;
        color: var(--anthropic-light);
      }

      .seed-input:focus {
        outline: none;
        border-color: var(--anthropic-blue);
        box-shadow: 0 0 0 2px rgba(106, 155, 204, 0.2);
        background: rgba(250, 249, 245, 0.15);
      }

      .seed-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-bottom: 8px;
      }

      .control-group {
        margin-bottom: 20px;
      }

      .control-group label {
        display: block;
        font-size: 14px;
        font-weight: 500;
        color: var(--anthropic-light);
        margin-bottom: 8px;
      }

      .param-description {
        font-size: 12px;
        color: var(--anthropic-mid-gray);
        margin-bottom: 8px;
        line-height: 1.4;
      }

      .number-input {
        width: 100%;
        background: rgba(250, 249, 245, 0.1);
        padding: 8px 10px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        border: 1px solid rgba(106, 155, 204, 0.3);
        color: var(--anthropic-light);
      }

      .number-input:focus {
        outline: none;
        border-color: var(--anthropic-blue);
        box-shadow: 0 0 0 2px rgba(106, 155, 204, 0.2);
        background: rgba(250, 249, 245, 0.15);
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .slider-container input[type='range'] {
        flex: 1;
      }

      input[type='range'] {
        width: 100%;
        height: 4px;
        background: rgba(106, 155, 204, 0.2);
        border-radius: 2px;
        outline: none;
        -webkit-appearance: none;
      }

      input[type='range']::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        background: var(--anthropic-blue);
        cursor: pointer;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      input[type='range']::-moz-range-thumb {
        width: 16px;
        height: 16px;
        background: var(--anthropic-blue);
        cursor: pointer;
        border-radius: 50%;
        border: none;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .value-display {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        color: var(--anthropic-blue);
        min-width: 60px;
        text-align: right;
      }

      button,
      .button {
        width: 100%;
        padding: 10px 16px;
        background: var(--anthropic-blue);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        font-family: 'Poppins', sans-serif;
      }

      button:hover,
      .button:hover {
        background: #5a8ab0;
        transform: translateY(-1px);
      }

      button:active,
      .button:active {
        transform: translateY(0);
      }

      .button.secondary {
        background: var(--anthropic-orange);
      }

      .button.secondary:hover {
        background: #c86641;
      }

      .button.tertiary {
        background: var(--anthropic-green);
      }

      .button.tertiary:hover {
        background: #6b7b52;
      }

      .button-row {
        display: flex;
        gap: 8px;
      }

      .button-row .button {
        flex: 1;
      }

      .main-content {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      #canvas-container {
        border-radius: 12px;
        overflow: hidden;
        box-shadow:
          0 20px 60px rgba(0, 0, 0, 0.8),
          0 0 80px rgba(106, 155, 204, 0.3),
          inset 0 0 20px rgba(106, 155, 204, 0.1);
        border: 2px solid rgba(106, 155, 204, 0.4);
      }

      .info-box {
        background: rgba(106, 155, 204, 0.1);
        border-left: 3px solid var(--anthropic-blue);
        padding: 12px;
        border-radius: 4px;
        font-size: 12px;
        line-height: 1.6;
        color: var(--anthropic-mid-gray);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <aside class="sidebar">
        <h1>Lightspeed Jump</h1>
        <p class="subtitle">
          Experience faster-than-light travel from the cockpit. Watch stars transform into streaming light as your ship
          jumps to hyperspace.
        </p>

        <div class="control-section">
          <h3>Seed Navigation</h3>
          <input type="text" id="seedInput" class="seed-input" />
          <div class="seed-controls">
            <button id="prevBtn">â† Previous</button>
            <button id="nextBtn">Next â†’</button>
          </div>
          <button id="randomBtn">ğŸ² Random Seed</button>
        </div>

        <div class="control-section">
          <h3>Hyperdrive Controls</h3>

          <div class="control-group">
            <label for="starCount">Star Count</label>
            <div class="param-description">Number of stars in the starfield (200-1500)</div>
            <div class="slider-container">
              <input
                type="range"
                id="starCount"
                min="200"
                max="1500"
                step="50"
                oninput="updateConfig('starCount', this.value)"
              />
              <span class="value-display" id="starCount-value"></span>
            </div>
          </div>

          <div class="control-group">
            <label for="baseSpeed">Base Speed</label>
            <div class="param-description">Initial velocity before acceleration kicks in (0.5-5.0)</div>
            <div class="slider-container">
              <input
                type="range"
                id="baseSpeed"
                min="0.5"
                max="5"
                step="0.1"
                oninput="updateConfig('baseSpeed', this.value)"
              />
              <span class="value-display" id="baseSpeed-value"></span>
            </div>
          </div>

          <div class="control-group">
            <label for="accelFactor">Acceleration Factor</label>
            <div class="param-description">Exponential speed increase per frame (1.000-1.050)</div>
            <div class="slider-container">
              <input
                type="range"
                id="accelFactor"
                min="1.000"
                max="1.050"
                step="0.001"
                oninput="updateConfig('accelFactor', this.value)"
              />
              <span class="value-display" id="accelFactor-value"></span>
            </div>
          </div>

          <div class="control-group">
            <label for="maxTrail">Trail Length</label>
            <div class="param-description">Maximum points in each star's motion trail (5-50)</div>
            <div class="slider-container">
              <input
                type="range"
                id="maxTrail"
                min="5"
                max="50"
                step="1"
                oninput="updateConfig('maxTrail', this.value)"
              />
              <span class="value-display" id="maxTrail-value"></span>
            </div>
          </div>

          <div class="control-group">
            <label for="turbulence">Turbulence</label>
            <div class="param-description">Random drift applied to star trajectories (0.00-0.20)</div>
            <div class="slider-container">
              <input
                type="range"
                id="turbulence"
                min="0"
                max="0.20"
                step="0.01"
                oninput="updateConfig('turbulence', this.value)"
              />
              <span class="value-display" id="turbulence-value"></span>
            </div>
          </div>

          <div class="control-group">
            <label for="spawnRate">Spawn Rate</label>
            <div class="param-description">New stars created per spawn cycle (1-10)</div>
            <div class="slider-container">
              <input
                type="range"
                id="spawnRate"
                min="1"
                max="10"
                step="1"
                oninput="updateConfig('spawnRate', this.value)"
              />
              <span class="value-display" id="spawnRate-value"></span>
            </div>
          </div>
        </div>

        <div class="control-section">
          <h3>Actions</h3>
          <div class="button-row">
            <button class="button secondary" onclick="randomizeParameters()">ğŸ² Randomize</button>
            <button class="button tertiary" onclick="resetParameters()">â†º Reset</button>
          </div>
        </div>

        <div class="info-box">
          <strong>Tip:</strong> Adjust the acceleration to control how quickly stars reach lightspeed. Higher values
          create more dramatic streaks!
        </div>
      </aside>

      <main class="main-content">
        <div id="canvas-container"></div>
      </main>
    </div>

    <script>
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                    LIGHTSPEED JUMP ALGORITHM
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      // Configuration
      const config = {
        seed: 42,
        starCount: 600,
        baseSpeed: 1.5,
        accelFactor: 1.018,
        maxTrail: 30,
        turbulence: 0.0,
        spawnRate: 10,
      };

      // Store defaults for reset
      const defaultConfig = { ...config };

      // Render constants
      const CANVAS_SIZE = 900;
      const SPAWN_RADIUS_MIN = 5;
      const SPAWN_RADIUS_MAX = 40;
      const DEPTH_MIN = 0.3;
      const DEPTH_MAX = 1.0;
      const LIFETIME_MIN = 180;
      const LIFETIME_MAX = 300;
      const SCREEN_MARGIN = 100;
      const BACKGROUND_FADE_ALPHA = 80;
      const SPAWN_FRAME_INTERVAL = 4;
      const START_STAR_FRACTION = 0.15;
      const SPEED_RAMP_FRAMES = 120;

      // Fade-out timing (velocity-based)
      const FADE_SLOW_STARS = 15; // frames for slow stars to fade
      const FADE_FAST_STARS = 3; // frames for fast stars to fade
      const VELOCITY_FADE_THRESHOLD = 15; // velocity above which stars fade faster

      // Color mapping (Doppler shift simulation)
      const HUE_SLOW = 0; // red/orange for slow stars
      const HUE_FAST = 220; // blue for fast stars
      const VELOCITY_MAX = 30;
      const SAT_HIGH = 90;
      const SAT_LOW = 10;
      const BRIGHTNESS = 95;

      // Alpha ranges (reduced to prevent white buildup)
      const ALPHA_MIN = 20;
      const ALPHA_MAX = 120;
      const ALPHA_VELOCITY_MAX = 25;
      const TRAIL_ALPHA_MULTIPLIER = 0.6;

      // Global state
      let stars = [];
      let cx, cy;
      let simFrame = 0;

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                         STAR CLASS
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      class Star {
        constructor() {
          this.respawn();
        }

        respawn() {
          // Spawn position: near center with random offset
          const spawnRadius = random(SPAWN_RADIUS_MIN, SPAWN_RADIUS_MAX);
          const spawnAngle = random(TWO_PI);
          this.x = cx + cos(spawnAngle) * spawnRadius;
          this.y = cy + sin(spawnAngle) * spawnRadius;
          this.angle = spawnAngle;

          // Velocity and physics
          this.speed = config.baseSpeed;
          this.velocity = this.speed;
          this.z = random(DEPTH_MIN, DEPTH_MAX); // depth for parallax effect

          // Visual trail
          this.trail = [];

          // Lifecycle
          this.life = 0;
          this.maxLife = random(LIFETIME_MIN, LIFETIME_MAX);
          this.colorShift = random(-15, 15); // color variation

          // State flags
          this.isDead = false;
          this.fadingOut = false;
          this.fadeOutProgress = 0;
        }

        update() {
          const rampProgress = min(1, simFrame / SPEED_RAMP_FRAMES);

          // Physics: Apply turbulence via Perlin noise
          const noiseFactor = noise(this.x * 0.005, this.y * 0.005, simFrame * 0.001);
          const angleShift = (noiseFactor - 0.5) * config.turbulence;
          this.angle += angleShift;

          // Physics: Exponential acceleration (relativistic effect)
          const rampedAccel = lerp(1, config.accelFactor, rampProgress);
          this.velocity *= rampedAccel;

          // Movement: Calculate velocity with parallax depth
          const vx = cos(this.angle) * this.velocity * this.z;
          const vy = sin(this.angle) * this.velocity * this.z;

          // Update position
          this.x += vx;
          this.y += vy;

          // Update trail
          if (!this.fadingOut) {
            // Normal state: move and build trail
            this.trail.push({ x: this.x, y: this.y });

            if (this.trail.length > config.maxTrail) {
              this.trail.shift();
            }
          } else {
            // Fade-out state: keep head moving without growing the trail
            if (this.trail.length > 0) {
              this.trail[this.trail.length - 1] = { x: this.x, y: this.y };
            }

            // Shrink trail faster to guarantee it clears by fade end
            const remainingFrames = Math.max(1, this.fadeOutDuration - this.fadeOutProgress);
            const removeCount = Math.max(1, Math.ceil(this.trail.length / remainingFrames));
            for (let i = 0; i < removeCount && this.trail.length > 0; i++) {
              this.trail.shift();
            }
          }

          // Lifecycle: age the star
          this.life++;

          // Lifecycle: check if star should start fading out
          const offScreen =
            this.x < -SCREEN_MARGIN ||
            this.x > width + SCREEN_MARGIN ||
            this.y < -SCREEN_MARGIN ||
            this.y > height + SCREEN_MARGIN;

          if (!this.fadingOut && (offScreen || this.life > this.maxLife)) {
            this.fadingOut = true;
            // Velocity-based fade duration: fast stars disappear quicker
            this.fadeOutDuration = floor(map(this.velocity, 0, VELOCITY_MAX, FADE_SLOW_STARS, FADE_FAST_STARS, true));
          }

          // Fade-out: update progress and mark as dead when complete
          if (this.fadingOut) {
            this.fadeOutProgress++;
            // Mark as dead when fade-out timer completes OR trail is empty
            if (this.fadeOutProgress >= this.fadeOutDuration || this.trail.length === 0) {
              this.isDead = true;
            }
          }
        }

        render() {
          if (this.trail.length < 2) return;

          const speed = this.velocity;

          // Color: Doppler shift simulation (red â†’ blue as speed increases)
          let hue = map(speed, 0, VELOCITY_MAX, HUE_SLOW, HUE_FAST, true);
          hue = constrain(hue + this.colorShift, 0, 240);

          // Saturation: decreases at high speed (approaching white light)
          const sat = map(speed, 0, VELOCITY_MAX, SAT_HIGH, SAT_LOW, true);

          // Brightness: affected by parallax depth and age
          const lifeFade = map(this.life, 0, this.maxLife, 1, 0.4);
          const bright = BRIGHTNESS * this.z * lifeFade;

          // Alpha: based on speed (reduced to prevent white accumulation)
          let alpha = map(speed, 0, ALPHA_VELOCITY_MAX, ALPHA_MIN, ALPHA_MAX, true) * lifeFade;

          // Apply fade-out effect for dying stars
          if (this.fadingOut) {
            const fadeMultiplier = 1 - this.fadeOutProgress / this.fadeOutDuration;
            alpha *= fadeMultiplier;
          }

          // Render trail segments
          for (let i = 1; i < this.trail.length; i++) {
            const prev = this.trail[i - 1];
            const curr = this.trail[i];

            // Gradient fade along the trail
            const segmentFade = i / this.trail.length;
            const segmentAlpha = alpha * segmentFade * TRAIL_ALPHA_MULTIPLIER;

            // Line thickness: increases with speed and depth
            const thickness = map(speed, 0, ALPHA_VELOCITY_MAX, 0.5, 4, true) * this.z;

            stroke(hue, sat, bright, segmentAlpha);
            strokeWeight(thickness);
            line(prev.x, prev.y, curr.x, curr.y);
          }

          // Render bright endpoint for high-velocity stars
          if (speed > VELOCITY_FADE_THRESHOLD) {
            noStroke();

            // Core point
            fill(hue, sat * 0.3, 100, alpha * 0.8);
            circle(this.x, this.y, 4 * this.z);

            // Outer glow
            fill(hue, sat * 0.1, 100, alpha * 0.3);
            circle(this.x, this.y, 8 * this.z);
          }
        }
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                         P5.JS SETUP
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      function setup() {
        const canvas = createCanvas(CANVAS_SIZE, CANVAS_SIZE);
        canvas.parent('canvas-container');

        colorMode(HSB, 360, 100, 100, 255);
        blendMode(ADD); // Additive blending for light accumulation

        cx = width / 2;
        cy = height / 2;

        applySeedAndReset(config.seed);
      }

      function applySeed(seed) {
        randomSeed(seed);
        noiseSeed(seed);
        config.seed = seed;
        document.getElementById('seedInput').value = seed;
      }

      function resetSimulation() {
        stars = [];
        const initialCount = Math.max(1, Math.floor(config.starCount * START_STAR_FRACTION));
        for (let i = 0; i < initialCount; i++) {
          const star = new Star();
          // Stagger initial life for smooth animation start
          star.life = floor(random(0, star.maxLife * 0.6));
          stars.push(star);
        }
        simFrame = 0;

        // Clear canvas completely
        clear();
        background(0, 0, 0, 255);
      }

      function applySeedAndReset(seed) {
        applySeed(seed);
        resetSimulation();
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                        DRAW LOOP
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      function draw() {
        // Background fade must be drawn in BLEND mode so it actually clears
        blendMode(BLEND);
        background(0, 0, 0, BACKGROUND_FADE_ALPHA);
        blendMode(ADD);

        // Draw central hyperspace portal
        drawWarpCore();

        // Spawn system: add new stars at controlled rate
        if (simFrame % SPAWN_FRAME_INTERVAL === 0 && stars.length < config.starCount) {
          for (let i = 0; i < config.spawnRate; i++) {
            if (stars.length < config.starCount) {
              stars.push(new Star());
            }
          }
        }

        // Update and render stars (iterate backwards for safe removal)
        for (let i = stars.length - 1; i >= 0; i--) {
          const star = stars[i];
          star.update();

          if (star.isDead) {
            stars.splice(i, 1);
          } else {
            star.render();
          }
        }

        simFrame++;
      }

      function drawWarpCore() {
        const t = simFrame * 0.03;
        const pulse = 0.5 + 0.25 * sin(t);
        const flicker = 0.95 + 0.05 * noise(simFrame * 0.02);
        const outerRadius = 100;
        const innerRadius = 32;

        noStroke();

        // Outer energy haze with subtle chromatic drift
        for (let r = outerRadius; r > 0; r -= 6) {
          const ringT = r / outerRadius;
          const hue = lerp(205, 185, ringT) + sin(t + r * 0.04) * 4;
          const sat = lerp(70, 30, ringT);
          const bright = lerp(80, 92, ringT);
          const alpha = (1 - ringT) * 22 * (0.8 + 0.2 * pulse);
          fill(hue, sat, bright, alpha);
          circle(cx, cy, r * 2);
        }

        // Ion ring
        noFill();
        stroke(195, 35, 90, 22 * (0.7 + 0.3 * pulse));
        strokeWeight(1);
        circle(cx, cy, (innerRadius + 12 + 3 * sin(t * 1.4)) * 2);

        // Sheared rings for a warped-lens effect
        push();
        translate(cx, cy);
        rotate(t * 0.25);
        stroke(210, 30, 90, 12);
        strokeWeight(0.7);
        ellipse(0, 0, (innerRadius + 18) * 2, (innerRadius + 10) * 2);
        rotate(PI / 3);
        stroke(185, 25, 90, 10);
        ellipse(0, 0, (innerRadius + 16) * 2, (innerRadius + 14) * 2);
        pop();

        // Inner bright portal
        noStroke();
        for (let r = innerRadius; r > 0; r -= 3) {
          const alpha = map(r, 0, innerRadius, 60, 0) * flicker;
          fill(190, 20, 85, alpha);
          circle(cx, cy, r * 2);
        }

        // Core point + pulse aura
        fill(0, 0, 80, 90);
        circle(cx, cy, 6 + 2 * pulse);
        fill(180, 10, 80, 14 * (0.4 + 0.6 * pulse));
        circle(cx, cy, 14 + 2 * pulse);
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                          UI CONTROLS
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      // Parameter formatting configuration
      const intParams = new Set(['starCount', 'maxTrail', 'spawnRate']);
      const oneDecimalParams = new Set(['baseSpeed']);
      const threeDecimalParams = new Set(['accelFactor']);
      const twoDecimalParams = new Set(['turbulence']);

      function formatParamValue(paramName, value) {
        if (intParams.has(paramName)) {
          return String(Math.round(value));
        }
        if (oneDecimalParams.has(paramName)) {
          return Number(value).toFixed(1);
        }
        if (twoDecimalParams.has(paramName)) {
          return Number(value).toFixed(2);
        }
        if (threeDecimalParams.has(paramName)) {
          return Number(value).toFixed(3);
        }
        return String(value);
      }

      function updateConfig(param, value) {
        let numValue = parseFloat(value);

        // Apply rounding for integer parameters
        if (intParams.has(param)) {
          numValue = Math.round(numValue);
        }

        config[param] = numValue;

        // Update display with formatted value
        const valueElement = document.getElementById(param + '-value');
        if (valueElement) {
          valueElement.textContent = formatParamValue(param, numValue);
        }

        // Update input element value for consistency
        const inputElement = document.getElementById(param);
        if (inputElement && inputElement.type === 'number') {
          inputElement.value = numValue;
        }

        // Always reset the simulation for a clean state on parameter changes
        resetSimulation();
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                    RANDOMIZE & RESET FUNCTIONS
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      function randomizeParameters() {
        // Randomize all parameters with sensible ranges
        config.starCount = Math.floor(Math.random() * 14) * 100 + 200; // 200-1500 in steps of 100
        config.baseSpeed = Math.floor(Math.random() * 45) * 0.1 + 0.5; // 0.5-5.0
        config.accelFactor = Math.floor(Math.random() * 50) * 0.001 + 1.0; // 1.000-1.050
        config.maxTrail = Math.floor(Math.random() * 46) + 5; // 5-50
        config.turbulence = Math.floor(Math.random() * 21) * 0.01; // 0.00-0.20
        config.spawnRate = Math.floor(Math.random() * 10) + 1; // 1-10

        // Also randomize seed
        config.seed = Math.floor(Math.random() * 1000000);

        // Update all UI elements
        updateAllUIElements();

        // Reinitialize
        applySeedAndReset(config.seed);
      }

      function resetParameters() {
        // Restore all parameters to defaults
        Object.assign(config, defaultConfig);

        // Update all UI elements
        updateAllUIElements();

        // Reinitialize
        applySeedAndReset(config.seed);
      }

      function updateAllUIElements() {
        // Update seed input
        document.getElementById('seedInput').value = config.seed;

        // Update all parameter inputs and displays
        Object.keys(config).forEach((param) => {
          if (param === 'seed') return;

          const inputElement = document.getElementById(param);
          const valueElement = document.getElementById(param + '-value');

          if (inputElement) {
            inputElement.value = config[param];
          }

          if (valueElement) {
            valueElement.textContent = formatParamValue(param, config[param]);
          }
        });
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      //                      EVENT LISTENERS SETUP
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      // Seed controls
      document.getElementById('prevBtn').addEventListener('click', () => {
        applySeedAndReset(config.seed - 1);
      });

      document.getElementById('nextBtn').addEventListener('click', () => {
        applySeedAndReset(config.seed + 1);
      });

      document.getElementById('randomBtn').addEventListener('click', () => {
        applySeedAndReset(floor(random(1000000)));
      });

      document.getElementById('seedInput').addEventListener('change', (e) => {
        const newSeed = parseInt(e.target.value) || 42;
        applySeedAndReset(newSeed);
      });

      // Initialize UI on load
      window.addEventListener('load', function () {
        updateAllUIElements();
      });
    </script>
  </body>
</html>
